{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Mario%20GGS/fp-ecommerce/src/app/search/page.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { useSearchParams } from \"next/navigation\";\nimport { useEffect, useState } from \"react\";\nimport { supabase } from \"../lib/supabaseClient\";\n\ninterface Producto {\n  id_producto: number;\n  nombre_producto: string;\n  precio_minimo?: number;\n  establecimiento?: string;\n}\n\nexport default function SearchResults() {\n  const searchParams = useSearchParams();\n  const query = searchParams.get(\"q\") || \"\";\n  const [productos, setProductos] = useState<Producto[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchSearchResults = async () => {\n      if (!query) {\n        setLoading(false);\n        return;\n      }\n\n      setLoading(true);\n      try {\n        // Buscar productos que coincidan con la consulta\n        const { data: productosData, error: productosError } = await supabase\n          .from(\"productos\")\n          .select(\"id_producto, nombre_producto\")\n          .ilike(\"nombre_producto\", `%${query}%`)\n          .order(\"nombre_producto\");\n\n        if (productosError) throw productosError;\n\n        // Para cada producto, obtener el precio más bajo\n        const productosConPrecios = await Promise.all(\n          (productosData || []).map(async (producto) => {\n            const { data: preciosData } = await supabase\n              .from(\"precios\")\n              .select(\n                `\n                precio_producto,\n                establecimientos:id_establecimiento(nombre_establecimiento)\n              `\n              )\n              .eq(\"id_producto\", producto.id_producto)\n              .order(\"precio_producto\", { ascending: true })\n              .limit(1);\n\n            const precio =\n              preciosData && preciosData.length > 0\n                ? {\n                    precio_minimo: preciosData[0].precio_producto,\n                    establecimiento:\n                      preciosData[0].establecimientos?.nombre_establecimiento ||\n                      \"Desconocido\",\n                  }\n                : { precio_minimo: undefined, establecimiento: undefined };\n\n            return {\n              ...producto,\n              ...precio,\n            };\n          })\n        );\n\n        setProductos(productosConPrecios);\n      } catch (err) {\n        console.error(\"Error al buscar productos:\", err);\n        setError(\"Ha ocurrido un error al buscar productos\");\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchSearchResults();\n  }, [query]);\n\n  return (\n    <div className=\"container mx-auto py-8 px-4\">\n      <h1 className=\"text-2xl font-bold mb-6\">\n        Resultados para: <span className=\"text-red-600\">\"{query}\"</span>\n      </h1>\n\n      {loading ? (\n        <div className=\"flex justify-center items-center py-12\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600\"></div>\n        </div>\n      ) : error ? (\n        <div className=\"bg-red-100 text-red-700 p-4 rounded-md\">{error}</div>\n      ) : productos.length === 0 ? (\n        <div className=\"text-center py-12\">\n          <p className=\"text-gray-600 mb-4\">\n            No se encontraron productos que coincidan con tu búsqueda.\n          </p>\n          <p className=\"text-gray-500\">\n            Intenta con otros términos o explora nuestras categorías.\n          </p>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n          {productos.map((producto) => (\n            <Link\n              href={`/productname?nombre=${encodeURIComponent(\n                producto.nombre_producto\n              )}`}\n              key={producto.id_producto}\n              className=\"bg-white rounded-lg shadow hover:shadow-md transition-shadow p-4 flex flex-col\"\n            >\n              <div className=\"h-40 bg-gray-200 rounded-md mb-4 flex items-center justify-center\">\n                <span className=\"text-gray-400\">\n                  {producto.nombre_producto}\n                </span>\n              </div>\n              <h2 className=\"font-semibold text-lg mb-2\">\n                {producto.nombre_producto}\n              </h2>\n              {producto.precio_minimo ? (\n                <>\n                  <p className=\"text-gray-600 text-sm mb-1\">\n                    Menor precio en: {producto.establecimiento}\n                  </p>\n                  <p className=\"text-red-600 font-bold mt-auto\">\n                    ${producto.precio_minimo.toFixed(2)}\n                  </p>\n                </>\n              ) : (\n                <p className=\"text-gray-500 italic mt-auto\">\n                  Precios no disponibles\n                </p>\n              )}\n            </Link>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 219, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}